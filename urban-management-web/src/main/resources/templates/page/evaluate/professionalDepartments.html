<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>热线上报</title>
    <th:block th:include="page/fragments/common :: common_css"/>
    <th:block th:include="page/fragments/common :: fileUpload_css"/>
    <th:block th:include="page/fragments/common :: bootstrap_table_css"/>
    <th:block th:include="page/fragments/common :: bootstrap_datepicker_css"/>
</head>
<style>
    .bootstrap-table {
        width: 100%;
        padding: 0 10px 0px 10px !important;
    }
</style>
<body style="border-radius: 8px;">
<div class="bigTitle">专业部门评价</div>
<div class="search_box">
    <div class="search_inner">
        <form class="details">
            <div class="top table2_top">
                <div class="top_out">
                    <table class="table">
                        <tbody>
                        <tr>
                            <td><span></span>开始日期</td>
                            <td>
                                <input size="16" class="form_datetime" id="begin" type="text" value="" readonly>
                            </td>
                            <td><span></span>结束日期</td>
                            <td>
                                <input size="16" class="form_datetime" id="end" type="text" value="" readonly>
                            </td>
                            <td style="float: right;margin-right: 5px">
                                <button class="check_btn">查询</button>
                            </td>
                        </tr>
                        </tbody>
                    </table>

                </div>

                <!--                            按钮-->
                <div class="notice_bot">
                    <!--            <div class="l_left">-->
                    <!--                <input type="checkbox" checked="checked"/>保存并关闭窗口-->
                    <!--            </div>-->
                    <div class="r_right but_p btn_search dates">
                        <button class="check_btn2" type="button" id="theWeek">本周</button>
                        <button class="check_btn2" type="button" id="theMonth">本月</button>
                        <button class="check_btn2" type="button" id="theuarter">本季</button>
                        <button class="check_btn2" type="button" id="theYear">本年</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
<div class="contents">
    <table id="table" class="table_style" style="margin: 0 auto;margin-top: 10px"></table>
    <div class="explain">
        <div class="explain_box">
            <p style="padding-left: 0px">注：1）综合指标值中，各个指标的分值计算方法如下：</p>
            <p>立案数分值：0~50 件 100 分；51~100 件 90 分；100~200 件 75 分；200~500 件 60 分；500~1000 件</p>
            <p>40 分；1000件及以上0分。宜根据部门工作职责分组设定立案数分值</p>
            <p>结案率分值：结案率×100</p>
            <p>按期处置率分值：按期处置率×100</p>
            <p>返工率分值：（1-返工率）×100</p>
            <p style="padding-left: 25px">2）综合指标值的计算公式如下：</p>
            <p>综合指标值=立案数分值×10%+结案数分值×30%+按期处置率分值×30%+返工率分值×30%</p>
        </div>
    </div>
</div>

<th:block th:include="page/fragments/common :: common_js"/>
<th:block th:include="page/fragments/common :: jquery_validation_js"/>
<th:block th:include="page/fragments/common :: fileUpload_js"/>
<th:block th:include="page/fragments/common :: bootstrap_table_js"/>
<th:block th:include="page/fragments/common :: bootstrap_datepicker_js"/>
<script type="text/javascript" th:inline="javascript">
    $(function () {
        ////日期插件
        $('.form_datetime').datetimepicker({
            language: 'zh-CN',
            weekStart: 1,
            todayBtn: 1,
            autoclose: 1,
            todayHighlight: 1,
            startView: 2,
            forceParse: 0,
            showMeridian: 1,
            format: "yyyy-mm-dd hh:ii:ss"
        });

        search();

        var date = new Date();
        //本周
        $("#theWeek").click(function () {
            // 本周一的日期
            date.setDate(date.getDate() - date.getDay() + 1);
            let begin = date.getFullYear() + "-" + (date.getMonth() + 1) + "-" + date.getDate() + " 00:00:00";
            $("#begin").val(begin)
            // 本周日的日期
            date.setDate(date.getDate() + 6);
            let end = date.getFullYear() + "-" + (date.getMonth() + 1) + "-" + date.getDate() + " 23:59:59";
            $("#end").val(end)
            // console.log(begin,end)
        });

        //本月
        $("#theMonth").click(function () {
            //月一
            let year = date.getFullYear();
            let month = date.getMonth() + 1;
            month = month > 9 ? month : "0" + month;

            let firstDayOfCurMonth = `${year}-${month}-01`;
            let lastDay = new Date(year, month, 0);
            let lastDayOfCurMonth = `${year}-${month}-${lastDay.getDate()}`;
            $("#begin").val(firstDayOfCurMonth + " 00:00:00")
            $("#end").val(lastDayOfCurMonth + " 23:59:59")
        });

        //本季
        $("#theuarter").click(function () {
            function getQuarterMonth(type){
                var now = new Date();
                var nowMonth = now.getMonth();
                var year = now.getFullYear();
                var quarterStartMonth = 1;
                if(nowMonth<3){
                    quarterStartMonth = 1;
                }
                if(2<nowMonth && nowMonth<6){
                    quarterStartMonth = 4;
                }
                if(5<nowMonth && nowMonth<9){
                    quarterStartMonth = 7;
                }
                if(nowMonth>8){
                    quarterStartMonth = 10;
                }
                if (type == "s") {
                    var day = year+"-"+quarterStartMonth+"-01";
                };
                if (type == "e") {
                    if(quarterStartMonth==1){
                        var day = year+"-"+(quarterStartMonth+2)+"-31";
                    }
                    if(quarterStartMonth==10){
                        var day = year+"-"+(quarterStartMonth+2)+"-31";
                    }
                    if(quarterStartMonth==4){
                        var day = year+"-"+(quarterStartMonth+2)+"-30";
                    }
                    if(quarterStartMonth==7){
                        var day = year+"-"+(quarterStartMonth+2)+"-30";
                    }
                };
                return day;
            }
            $("#begin").val(getQuarterMonth("s",1) + " 00:00:00")
            $("#end").val(getQuarterMonth("e",1) + " 23:59:59")
        });

        //本年
        $("#theYear").click(function () {
            let year = date.getFullYear();
            $("#begin").val(year + "-" +"01-01" + " 00:00:00")
            $("#end").val(year + "-" +"12-31" + " 23:59:59")
        });
    })

    $('#table').bootstrapTable({
        columns: [
            {
                field: 'index',
                title: '序号',
            },
            {
                title: '部门',
                field: "deptName"
            },
            {
                field: 'registerNum',
                title: '立案数',
            },
            {
                field: 'onTimeCloseNum',
                title: '按期结案数',
            },
            {
                field: 'closeNum',
                title: "总结案数",
            },
            {
                field: 'mustCloseNum',
                title: '应结案数',
            },
            {
                field: 'closeRate',
                title: '结案率',
            },
            {
                field: 'onTimeManagementNum',
                title: '按期处置数',
            },
            {
                field: 'mustManagementNum',
                title: '应处置数',
            },
            {
                field: 'onTimeManagementRate',
                title: '按期处置率',
            },
            {
                field: 'reworkNum',
                title: '返工数',
            },
            {
                field: 'managementNum',
                title: '处置数',
            },
            {
                field: 'reworkRate',
                title: '返工率',

            },
            {
                field: 'objState',
                title: '综合标准值',

            },
            {
                field: 'initialDate',
                title: '评价等级',
            },

        ],
        data: []
    });
    let cellGridRegionUrl = /*[[@{/dept/evaluate}]]*/ "/dept/evaluate";

    function search() {
        $.ajaxUtil.get(cellGridRegionUrl, function (e) {
            console.log(e.data)
            $(e.data).each(function (index, value) {
                $('#table').bootstrapTable('insertRow', {
                    index: index,
                    row: {
                        index: index + 1,
                        deptName: value.deptName,
                        registerNum: value.registerNum,
                        onTimeCloseNum: value.onTimeCloseNum,
                        closeNum: value.closeNum,
                        mustCloseNum: value.mustCloseNum,
                        closeRate: value.closeRate,
                        mustManagementNum: value.mustManagementNum,
                        onTimeManagementNum: value.onTimeManagementNum,
                        onTimeManagementRate: value.onTimeManagementRate,
                        reworkNum: value.reworkNum,
                        managementNum: value.managementNum,
                        reworkRate: value.reworkRate
                    }
                });
            });
        });
    }


</script>
</body>
</html>
