<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>城市综合管理服务平台</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/main.css}"/>
</head>

<body>
<div class="top">
    <div class="title">
        <div class="logo">
            <img th:src="@{/img/logo.png}" alt="">
        </div>
        <div class="name">城市综合管理服务平台</div>
    </div>
    <div class="users" th:if="${#authentication.principal ne 'anonymousUser'}">
        <div class="head">
            <img th:src="@{/img/logo.png}" alt="">
        </div>
        <div class="username_nn" th:sec:authentication="principal.name"></div>
    </div>
    <div class="quit" th:if="${#authentication.principal ne 'anonymousUser'}">
        <img th:src="@{/img/out.png}" alt="">
    </div>
</div>
<div class="solid">
    <div class="post">
        <div class="center-point">
            <!--            无权限盒子-->
            <div class="noFlat">
                <div class="lion">
                    <div class="lionIn">
                        <img th:src="@{/img/lion.png}" alt="">
                    </div>
                </div>
            </div>


            <div class="work workActive">
                <div class="computer">
                    <img th:src="@{/img/computer.png}" alt="">
                </div>
                <p class="worktable">指挥协调</p>
            </div>
            <div class="work">
                <div class="computer">
                    <img th:src="@{/img/command.png}" alt="">
                </div>
                <p class="worktable">大屏展示</p>
            </div>
            <div class="work">
                <div class="computer">
                    <img th:src="@{/img/public.png}" alt="">
                </div>
                <p class="worktable">园林绿化</p>
            </div>
            <div class="work">
                <div class="computer">
                    <img th:src="@{/img/workin.png}" alt="">
                </div>
                <p class="worktable">市容环卫</p>
            </div>
            <div class="work">
                <div class="computer">
                    <img th:src="@{/img/change.png}" alt="">
                </div>
                <p class="worktable">市政公用</p>
            </div>
            <div class="work">
                <div class="computer">
                    <img th:src="@{/img/bigshow.png}" alt="">
                </div>
                <p class="worktable">综合执法</p>
            </div>
        </div>
        <div class="surround-box">
            <div class="circle circle1 active">
                <input  class="identification"  value="0" style="display: none">
                <p class="other other1 otherActive">Work Bench</p>
                <p class="inner inner1">指挥协调</p>
            </div>
            <div class="circle circle2">
                <input  class="identification"  value="0" style="display: none">
                <p class="other other2">Command coordination</p>
                <p class="inner inner2">大屏展示</p>
            </div>
            <div class="circle circle3 ">
                <input  class="identification"  value="0" style="display: none">
                <p class="other other3">public service</p>
                <p class="inner inner3">园林绿化</p>
            </div>
            <div class="circle circle4">
                <input  class="identification"  value="0" style="display: none">
                <p class="inner">市容环卫</p>
                <p class="other">Industry application</p>
            </div>
            <div class="circle circle5">
                <input  class="identification"  value="0" style="display: none">
                <p class="inner">市政公用</p>
                <p class="other">collection exchange</p>
            </div>
            <div class="circle circle6">
                <input  class="identification"  value="0" style="display: none">
                <p class="inner">综合执法</p>
                <p class="other">Large screen display</p>
            </div>
        </div>
    </div>
    <div class="get">


        <div class="robot"></div>
        <div class="info" >
            <div class="test testActive test1" th:if="${#authentication.principal eq 'anonymousUser'}">
                <div class="intoBtn temporary testActive" th:if="${#authentication.principal ne 'anonymousUser'}">进入系统</div>
                <div class="textsInbig">
                    <div class="login_main">
                        <div class="login">
                            <div class="message">登录账号</div>
                            <div id="darkbannerwrap"></div>
                            <form id="loginForm">
                                <div class="inpBox">
                                    <div class="icon icon1"></div>
                                    <input name="username" placeholder="账号" id="username" type="text" class="username">
                                </div>

                                <hr class="hr20">
                                <div class="inpBox">
                                    <div class="icon icon2"></div>
                                    <input name="password" placeholder="密码" id="password" type="password" class="password">
                                </div>

                                <hr class="hr20">

                                <div class="inpBox">
                                    <div class="icon icon3"></div>
                                    <img id="captchaImg" th:src="@{/captcha.jpeg}" class="canvas" alt="验证码" title="点击图片刷新验证码" onclick="changeCaptcha()">
                                    <input name="input-val" autocomplete="off" class="input-val" placeholder="请输入验证码" id="captcha" type="text" maxlength="4" >
                                </div>

                                <hr class="hr20">
                            </form>

                            <input value="登录" style="width: 100%;" type="button" onclick="login()" id="login_btn" class="login_btn">
                            <!--    <span class="forget">忘记密码?</span>-->
                        </div>
                    </div>
                </div>
            </div>
            <div class="test testActive" th:if="${#authentication.principal ne 'anonymousUser'}" style="position: relative">
                <div class="intoBtn temporary testActive">进入系统</div>

                <div class="textsInbig">
                    &nbsp; &nbsp;&nbsp;&nbsp;
                    以数字地图和单元网格划分为基础，集成基础地理、地理编码、市政及社区服务部件事件的多种数据资源，以城市监管员和市民服务热线为信息收集渠道，创建城市管理和市民服务综合指挥系统。通过多部门信息共享、协同工作，构建起沟通快捷、责任到位、处置及时、运转高效的城市管理、公共服务的监督和处置新机制，全面提高城市管理和政府公共服务水平。
                </div>
            </div>
            <div class="test">
                <div class="intoBtn temporary">进入系统</div>

                <div class="textsInbig">
                    &nbsp; &nbsp;&nbsp;&nbsp;
                    以大数据为基础进行综合分析、过滤形成可视化的科学数据展示，利用当前的可视化手段，将要展现的数据转化为基本图表、置于物理大屏，从而方便使用者更准确与科学的进行决策。
                </div>
            </div>
            <div class="test">
                <div class="intoBtn temporary">进入系统</div>

                <div class="textsInbig">
                    &nbsp; &nbsp;&nbsp;&nbsp;
                    是运用“互联网+”思维和物联网、大数据云计算、移动互联网、信息智能终端等新一代信息技术，与现代生态园林相融合，建立智慧园林大数据库，把人与自然用智慧的方式连接起来，达到人与自然的互感、互知、互动。
                </div>
            </div>
            <div class="test">
                <div class="intoBtn temporary">进入系统</div>

                <div class="textsInbig">
                    &nbsp; &nbsp;&nbsp;&nbsp;
                    面向城市市政设施管理、维修养护部门，涉及市政日常业务全流程。智慧市政综合监管平台是一个包含基础数据采集、基础设施管理、日常巡查养护等基础功能和道桥、路灯、井盖、排水等多个专业应用系统为一体的综合信息管理平台。通过智慧市政综合监管平台的建设，构建可持续的市政公用事业综合监管新模式，有效加强对提供服务的企事业单位进行监督、评价、考核，提高公用事业的服务质量和群众满意度
                </div>
            </div>
            <div class="test">
                <div class="intoBtn temporary">进入系统</div>

                <div class="textsInbig">
                    &nbsp; &nbsp;&nbsp;&nbsp;
                    依托城市物联网、云计算、多网融合等现代化技术，运用数字基础资源、多维信息感知、协同工作处置、智能督察考评、预警决策分析等手段，量化城市管理部件、事件标准，建设城市管理、执法服务平台，形成具备高度感知、互联、智能的城市管理新模式。依托自主研发的“六位一体”综合执法平台，实现了执法办案全程无纸化、自动化、即时化。
                </div>
            </div>
            <div class="test">
                <div class="intoBtn temporary">进入系统</div>

                <div class="textsInbig">
                    &nbsp; &nbsp;&nbsp;&nbsp;
                    一体化管理指挥平台运用云计算和大数据、物联网和互联网、安防视频和工业控制等相关技术，通过智能终端感知设备进行数据采集、挖掘、分析及处理，通过互联网或移动互联网，建设统一的管理信息共享平台，实现对环卫管理所涉及到的人、车、物、事件进行全过程实时监督，提升环卫作业质量，降低环卫运营成本。
                </div>
            </div>

        </div>
    </div>
</div>
<!--<div class="footer">Copyright © 2020 联通（黑龙江）产业互联网有限公司</div>-->


</body>
<script type="text/javascript" th:src="@{/plugins/jquery/dist/jquery.min.js}"></script>
<script type="text/javascript" th:src="@{/js/main.js}"></script>
<script type="text/javascript" th:src="@{/plugins/jquery-serializejson/jquery.serializejson.js}"></script>
<script type="text/javascript" th:src="@{/plugins/layer/layer.js}"></script>
<script type="text/javascript" th:src="@{/plugins/jsencrypt/jsencrypt.min.js}"></script>
<script type="text/javascript" th:src="@{/plugins/jquery-validation/dist/jquery.validate.js}"></script>
<script type="text/javascript" th:src="@{/plugins/jquery-validation/dist/additional-methods.js}"></script>
<script type="text/javascript" th:src="@{/plugins/jquery-validation/dist/localization/messages_zh.js}"></script>

<script type="text/javascript" th:inline="javascript">
    let logoutUrl = /*[[@{/logout}]]*/ "/logout";
    $(document).keydown(function (e) {
        if (e.keyCode === 13){
            login()
        }
    })

    if (window.top !== window.self) {
        alert('未登录或登录超时。请重新登录');
        window.top.location = window.location
    }


    let loginUrl = /*[[@{/login}]]*/ "/login";

    let captchaUrl = /*[[@{/captcha.jpeg?}]]*/ "/captcha.jpeg";

    let indexUrl = /*[[@{/}]]*/ "/";

    let PUBLIC_KEY = [[${PUBLIC_KEY}]];


    function changeCaptcha() {
        $('#captchaImg').attr('src', captchaUrl + new Date().getTime() + '');
    }


    function login() {

        let username = $('#username').val();
        if (username.trim() === '') {
            layer.msg('请输入账号');
            return;
        }

        let password = $('#password').val();
        if (password.trim() === '') {
            layer.msg('请输入密码');
            return;
        }

        let captcha = $('#captcha').val();

        if (captcha.trim() === '') {
            layer.msg('请输入验证码');
            return;
        }


        let data = {
            username: username,
            password: encryptPassword(password),
            captcha: captcha
        }


        $.ajax({
            type: 'POST',
            url: loginUrl,
            data: data,
            beforeSend: function () {
                layer.msg('正在登录 请稍后...', {icon: 16, shade: 0.5, time: 0});
            },
            success: function (result) {
                if (result.code === 0) {
                    window.location.href = indexUrl;
                } else {
                    changeCaptcha();
                    layer.msg(result.message);
                }
            }
        });


    }

    function encryptPassword(password) {
        let encrypt = new JSEncrypt();
        encrypt.setPublicKey(PUBLIC_KEY);
        return encrypt.encrypt(password);
    }

</script>

</html>