<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
    <title>用户管理</title>
    <th:block th:include="page/fragments/common :: common_css"/>
    <th:block th:include="page/fragments/common :: bootstrap_table_css"/>
    <link th:href="@{/css/import.css}" rel="stylesheet" type="text/css">
    <th:block th:include="page/fragments/common :: map_css"/>
    <th:block th:include="page/fragments/common :: ztree_css"/>


</head>

<body style="background-color: #ecf0f5;font-family: 微软雅黑;color: #475059;min-width: 1150px;overflow: auto" >
<div class="innerBox">
    <div class="tree">
        <div class="treeDemo">
            <ul id="treeDemo" class="ztree">zTree</ul>
        </div>
    </div>
    <div class="tabels">
        <div class="notice_check">
            <form id="search-form">
                <p>
                    <label class="">图层分类</label>
                    <input type="text" readonly="readonly" id="typeStr" class="find_input" disabled>
                    <input type="text" readonly="readonly" id="componentTypeId" class="find_input" disabled>
                </p>
                <p>
                    <label class="">图层名称</label>
                    <input type="text" readonly="readonly"  class="find_input" disabled>
                </p>
                <p>
                    <label class="">位置信息</label>
                    <input type="text" readonly="readonly"  class="find_input coor" >
                </p>
                <p class="attribute">属性信息</p>
                <p>
                    <label class="">部件标识码</label>
                    <input type="text" class="find_input" name="objId">
                    <label class="">部件名称</label>
                    <input type="text" class="find_input" name="objName">
                </p>
                <p>
                    <label class="">主管部门代码</label>
                    <input type="text" class="find_input" name="mainDeptCode">
                    <label class="">主管部门名称</label>
                    <input type="text" class="find_input" name="mainDeptName">
                </p>
                <p>
                    <label class="">权属单位代码</label>
                    <input type="text" class="find_input" name="ownershipDeptCode">
                    <label class="">权属单位名称</label>
                    <input type="text" class="find_input" name="ownershipDeptName">
                </p>
                <p>
                    <label class="">养护部门代码</label>
                    <input type="text" class="find_input" name="maintenanceDeptCode">
                    <label class="">养护部门名称</label>
                    <input type="text" class="find_input" name="maintenanceDeptName">
                </p>
                <p>
                    <label class="">所在网格</label>
                    <select id="bgid"></select>
                    <label class="">部件状态</label>
                    <select id="objState" ></select>
                </p>
                <p>
                    <label class="">数据来源</label>
                    <select id="dataSource"></select>
                </p>

                <p class="function_btn">
                    <input type="button" class="check_btn1" onclick="" value="删除">
                    <input type="button" class="check_btn1" onclick="" value="修改">
                    <input type="button" class="check_btn1" onclick="" value="保存">
                    <input type="button" class="check_btn1" onclick="" value="返回">
                </p>
            </form>
        </div>
    </div>
    <div class="maps">
        <div class="map" id="map" style="width: 100%;height: 100%"></div>
    </div>
</div>




<th:block th:include="page/fragments/common :: common_js"/>
<th:block th:include="page/fragments/common :: bootstrap_table_js"/>
<th:block th:include="page/fragments/common :: map_js"/>
<th:block th:include="page/fragments/common :: ztree_js"/>
<script type="text/javascript" th:inline="javascript">

    var setting = {
        callback: {
            onClick: zTreeOnClick
        },
        data: {//数据加载
            keep: {
                parent: true,
                leaf: true
            },
            simpleData: {
                enable: true,
                idKey: 'id',
                pIdKey: 'parent'
            },
            key: {
                name: "name"
            }
        }
    };

    function zTreeOnClick(event, treeId, treeNode) {
        if(treeNode.children === undefined){
            $("#typeStr").val(treeNode.name);x
        }
    }

    $(function () {
        queryUserList();
        $.ajaxUtil.get(componentTypeUrl, function (e) {
            var zTreeObj = $.fn.zTree.init($("#treeDemo"), setting, e.data);
        })
        $.ajaxUtil.get(objStateUrl, function (e) {
            var objStateStr = "<option value=''>--请选择--</option>";
            $(e.data).each(function (index,value) {
                objStateStr += "<option value='"+value.id+"'>"+value.value+"</option>"
            })
            $("#objState").append(objStateStr);
        })
        $.ajaxUtil.get(dataSourceUrl, function (e) {
            var datasourceStr = "<option value=''>--请选择--</option>";
            $(e.data).each(function (index,value) {
                datasourceStr += "<option value='"+value.id+"'>"+value.value+"</option>"
            })
            $("#dataSource").append(datasourceStr);
        })
        $.ajaxUtil.get(gridUrl, function (e) {
            var gridStr = "<option value=''>--请选择--</option>";
            $(e.data).each(function (index,value) {
                gridStr += "<option value='"+value.id+"'>"+value.gridName+"</option>"
            })
            $("#bgid").append(gridStr);
        })
    })


    let searchUrl = /*[[@{/user/search}]]*/ "/json/unit.json";

    let addUrl = /*[[@{/user/add}]]*/ "/user/add";

    let removeUrl = /*[[@{/user/remove}]]*/ "/user/remove";

    let editUrl = /*[[@{/user/edit/{id}}]]*/ "/user/remove";

    let componentTypeUrl = /*[[@{/componentType}]]*/ "/componentType";

    let objStateUrl = /*[[@{/objState}]]*/ "/objState";

    let dataSourceUrl = /*[[@{/dataSource}]]*/ "/dataSource";

    let gridUrl = /*[[@{/grid}]]*/ "/grid";



    function queryUserList() {
        var options = {
            url: searchUrl,
            createUrl: addUrl,
            updateUrl: editUrl,
            removeUrl: removeUrl,
            // exportUrl: prefix + "/export",
            // importUrl: prefix + "/importData",
            // importTemplateUrl: prefix + "/importTemplate",
            uniqueId: "id",
            sortName: "updateTime",
            sortOrder: "desc",
            modalName: "用户",
            columns: [
                {
                    checkbox: true
                },
                {
                    title: '账号',
                    field: 'username'
                },
                {
                    title: '姓名',
                    field: 'name'
                },
                {
                    title: '手机号码',
                    field: 'mobileNumber'
                },
                {
                    title: '创建时间',
                    field: 'createTime',
                    sortable: true,
                },
                {
                    title: '修改时间',
                    field: 'updateTime',
                    sortable: true,

                },
                {
                    title: '操作',
                    field: '',
                    formatter: function (value, row) {
                        var e = '<a  href="#" title="" onclick="$.operate.remove(\'' + row.id + '\')">删除</a> ';
                        return e;
                    }
                }
            ]
        };
        $.table.init(options);
    }


    var center = ol.proj.transform([126.62, 45.74], "EPSG:4326", "EPSG:3857");
    var raster = new ol.layer.Tile({
        source: new ol.source.OSM()
    });
    var source = new ol.source.Vector({wrapX: false});
    //ol.layer.Vector用于显示在客户端渲染的矢量数据。
    var vector = new ol.layer.Vector({
        source: source
    });
    var map = new ol.Map({
        target: 'map',
        layers: [raster, vector],
        view: new ol.View({
            // projection: "EPSG:" + epsg,
            center: center,
            zoom: 12
        })
    });

    var draw = new ol.interaction.Draw({
        source: source,
        //点：Point   线:LineString      面:Polygon
        type: "Point",
    });
    map.addInteraction(draw)
    draw.on('drawstart', function () {
        // tarr.splice(0)
    })
    draw.on('drawend', function () {
        source.clear();
    });
    var layerMap = new ol.layer.Vector({
        source: new ol.source.Vector(),
    });
    map.addLayer(layerMap);

    var t;
    $("#map").click(function (e) {
        t = map.getEventCoordinate(e);
        $(".coor").val(t);

    });


    var selectSingleClick = new ol.interaction.Select();
    map.addInteraction(selectSingleClick);
    selectSingleClick.on('select', function (e) {
        let features = e.target.getFeatures().getArray();
        // let dataId = features[0].H.data.id;
        console.log("data", features);

    });


    var point = new ol.Feature({
        geometry: new ol.geom.Point([14093917.166992238, 5742844.590200588]),
        data: {
            id: 1
        }
    });
    layerMap.getSource().addFeature(point);



    /* ------------  点击事件  ------------------*/
    var selectClick = new ol.interaction.Select();
    map.addInteraction(selectClick);
    selectClick.on('select', function (e) {
        console.log(point)
        console.log(point.H.data)
        console.log(point.H.data.id)
    })

    /*layerMap.getSource().addFeature(multiPolygon);*/

    // function setPoint(x, y, data, name) {
    //     let point = new ol.Feature({
    //         geometry: new ol.geom.Point([x, y]),
    //         data: {
    //             id: data,
    //             name: name,
    //             coordinate: x + "," + y
    //         }
    //     });
    //     layerMap.getSource().addFeature(point);
    // }

</script>
</body>
</html>
