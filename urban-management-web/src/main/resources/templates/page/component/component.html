<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
    <title>用户管理</title>
    <th:block th:include="page/fragments/common :: common_css"/>
    <th:block th:include="page/fragments/common :: bootstrap_table_css"/>
    <th:block th:include="page/fragments/common :: bootstrap_datepicker_css"/>
    <th:block th:include="page/fragments/common :: ztree_css"/>
    <link th:href="@{/css/component.css}" rel="stylesheet" type="text/css">

</head>

<body style="background-color: #ecf0f5;font-family: 微软雅黑;color: #475059;min-width: 1150px;overflow: auto" >
<div class="notice_main ">

    <div class="notice_check">
        <form id="search-form">
            <p>
                <label class="">分类</label>
                <input type="text" readonly="readonly" id="typeStr" class="find_input"/>
                <input type="hidden" readonly="readonly" id="componentTypeId" class="find_input">
                <button type="button" class="addBtn"  data-toggle="modal" data-target="#modal-default">
                    +
                </button>
                <!--                <label class="">名称</label>-->
                <!--                <input type="text" class="find_input" name="name" >-->
                <input type="button" class="check_btn" onclick="" value="查询">
                <input type="button" class="check_btn1" onclick="" value="更多检索">
                <input type="button" class="check_btn1" onclick="" value="重置">
            </p>
            <p>
                <label class="">插件标识码</label>
                <input type="text" class="find_input" name="name">
                <label class="">部件名称</label>
                <input type="text" class="find_input" name="name">
                <label class="">主管部门代码</label>
                <input type="text" class="find_input" name="name">
            </p>
            <p>
                <label class="">主管部门名称</label>
                <input type="text" class="find_input" name="name">
                <label class="">权属单位代码</label>
                <input type="text" class="find_input" name="name">
                <label class="">权属单位名称</label>
                <input type="text" class="find_input" name="name">
            </p>
            <p>
                <label class="">养护单位代码</label>
                <input type="text" class="find_input" name="name">
                <label class="">养护单位名称</label>
                <input type="text" class="find_input" name="name">
                <label class="">所在单元网格</label>
                <input type="text" class="find_input" name="name">
            </p>
            <p>
                <label class="">部件状态</label>
                <select class="find_input" id="safeLevel" name="safeLevel" required>
                    <option>请选择</option>
                    <option>1</option>
                    <option>2</option>
                </select>
                <label class="">初始日期</label>
                <input type="text" class="find_input datepicker" readonly="readonly">
                <label class="">变更日期</label>
                <input type="text" class="find_input datepicker" readonly="readonly">
            </p>
            <p>
                <label class="">数据来源</label>
                <select class="find_input" name="safeLevel" required>
                    <option>请选择</option>
                    <option>1</option>
                    <option>2</option>
                </select>
                <input type="button" class="check_btn" onclick="" value="查询">
                <input type="button" class="check_btn1" onclick="" value="精简检索">
                <input type="button" class="check_btn1" onclick="" value="重置">
            </p>

        </form>
    </div>
    <div class="modal fade" id="modal-default">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">默认窗口</h4>
                </div>
                <div class="modal-body">
                    <div class="tree">
                        <div class="treeDemo">
                            <ul id="treeDemo" class="ztree">zTree</ul>
                        </div>
                    </div>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-success closemodal" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary">确认</button>
                </div>
            </div>
        </div>
    </div>
    <table id="table" class="component"></table>
    <div class="notice_check">
        <p>
            <input type="button" class="check_btn1" onclick="" value="更新">
        </p>
    </div>


    <button id="addBtn" onclick="add()">增加</button>

</div>


<th:block th:include="page/fragments/common :: common_js"/>
<th:block th:include="page/fragments/common :: bootstrap_table_js"/>
<th:block th:include="page/fragments/common :: bootstrap_datepicker_js"/>

<th:block th:include="page/fragments/common :: ztree_js"/>
<script type="text/javascript" th:inline="javascript">


    $('#table').bootstrapTable({


        //点击全选框时触发的操作
        onCheckAll:function(rows){
            $(".componentTable").removeAttr('disabled');
            $(".componentSelect").removeAttr('disabled');
            console.log(rows);
            for(var i=0;i<rows.length;i++)
            {
                // addItem(rows[i]);
                //alert(rows[i].ResultName)
            }
        },
        //  点击每行进行函数的触发
         onClickRow : function(row, tr,flied){


         },

        //点击每一个单选框时触发的操作
        onCheck:function(row){
            console.log(row);
            $(".selected .componentTable").removeAttr('disabled');
            $(".selected .componentSelect").removeAttr('disabled');
        },

        //取消每一个单选框时对应的操作；

        onUncheck:function(row,tr,flied){
            let input = tr[0].parentNode.parentNode;
            console.log(tr[0])
            // console.log(input)
            function sibling( elem ) {
                var r = [];
                var n = elem.parentNode.firstChild;
                for ( ; n; n = n.nextSibling ) {
                    if ( n.nodeType === 1 && n !== elem ) {
                        r.push( n );
                    }
                }
                return r;
            }
            var allBorther = sibling(input)
            // console.log(allBorther[14].childNodes[1])
            for(var i=0;i<10;i++){
                var selectInput = allBorther[14].childNodes[1]
                var selectInput2 = allBorther[11].childNodes[1]
                selectInput.setAttribute('disabled','disabled');
                selectInput2.setAttribute('disabled','disabled');
                var input12=allBorther[12].childNodes[0]
                var input13=allBorther[13].childNodes[0]
                input12.setAttribute('disabled','disabled');
                input13.setAttribute('disabled','disabled');
                var inputs = allBorther[i+1].childNodes[0]
                inputs.setAttribute('disabled','disabled');
            }
        },

        ////取消所有
        onUncheckAll: function (row) {
            $(".componentTable").attr('disabled','disabled');
            $(".componentSelect").attr('disabled','disabled');
            console.log(row)
        },
        columns: [
            {
                field: 'index',
                title: '序号',
            },
            {
                checkbox: true,
                title: '编辑',
                class: "check"
            },
            {
                field: 'componentType',
                title: '部件分类',
            },
            {
                field: 'objId',
                title: '部件标识码',
                formatter:priceForm,

            },
            {
                field: 'objName',
                title: '部件名称',
                formatter:priceForm,

            },
            {
                field: 'mainDeptCode',
                title: '主管部门代码',
                formatter:priceForm,

            },
            {
                field: 'mainDeptName',
                title: '主管部门名称',
                formatter:priceForm,
            },
            {
                field: 'ownershipDeptCode',
                title: '权属单位代码',
                formatter:priceForm,

            },
            {
                field: 'ownershipDeptName',
                title: '权属单位名称',
                formatter:priceForm,
            },
            {
                field: 'maintenanceDeptCode',
                title: '养护单位代码',
                formatter:priceForm,

            },
            {
                field: 'maintenanceDeptName',
                title: '养护单位名称',
                formatter:priceForm,

            },
            {
                field: 'grid',
                title: '所在单元网格',
                formatter:priceForm,

            },
            {
                field: 'objState',
                title: '部件状态',
                formatter:objState,

            },
            {
                field: 'initialDate',
                title: '初始日期',
                formatter:priceForm,

            },
            {
                field: 'changeDate',
                title: '变更日期',
                formatter:priceForm,

            },
            {
                field: 'sno',
                title: '数据来源',
                formatter:nameForm,

            },

        ],
        data:[]
    });
    //input输入框
    function priceForm(value,row,index){
        return ['<input type="text" id="1plan'+row.id+'" data='+value+' value='+value+' onblur="addTarget('+row.id+',1)" disabled="disabled" class="componentTable">'].join("")
    }
    //下拉列表
    function objState(value,row,index){
        console.log("obj",row)
        var objStateStr = "<select id=\"sele`+ row.id +`\" class=\"componentSelect\" disabled=\"disabled\">";
        $(objState.data).each(function (index, value) {
            if(row.objStateId !== value.id){
                objStateStr += "<option value='" + value.id + "'>" + value.value + "</option>"
            }else{
                objStateStr += "<option selected='selected' value='" + value.id + "'>" + value.value + "</option>"
            }
        })
        objStateStr += "</select>";
        $("#objState").append(objStateStr);
        return objStateStr;
    }
    function nameForm(value,row,index){

        return "";
    }


    function add(){
        var count = $('#table').bootstrapTable('getData').length;
        $.ajaxUtil.get(searchUrl, function (e) {
            console.log(e)
            $(e.data).each(function (index,value) {
                $('#table').bootstrapTable('insertRow',{index:count,row: {
                        index:index+1,
                        id:value.id,
                        name:value.objId,
                        componentType:value.componentType,
                        objId:value.objId,
                        objName:value.objName,
                        mainDeptCode:value.mainDeptCode,
                        mainDeptName:value.mainDeptName,
                        ownershipDeptCode:value.ownershipDeptCode,
                        ownershipDeptName:value.ownershipDeptName,
                        maintenanceDeptCode:value.maintenanceDeptCode,
                        maintenanceDeptName:value.maintenanceDeptName,
                        bgname:value.bgname,
                        bgid:value.bgid,
                        objState:value.objState,
                        objStateId:value.objStateId,
                        initialDate:value.initialDate,
                        changeDate:value.changeDate,
                        dataSource:value.dataSource,
                        dataSourceId:value.dataSourceId
                    }});
            })

        })
    }


    var setting = {
        callback: {
            onClick: zTreeOnClick
        },
        data: {//数据加载
            keep: {
                parent: true,
                leaf: true
            },
            simpleData: {
                enable: true,
                idKey: 'id',
                pIdKey: 'parent'
            },
            key: {
                name: "name"
            }
        }
    };

    function zTreeOnClick(event, treeId, treeNode) {
        $("#typeStr").val(treeNode.name);
        $("#componentTypeId").val(treeNode.id);
        $(".closemodal").click();
    }



    $(function () {
        $.ajaxUtil.get(componentTypeUrl, function (e) {
            var zTreeObj = $.fn.zTree.init($("#treeDemo"), setting, e.data);
        })
        $(".datepicker").datepicker({
            language: 'zh-CN',
            format: "yyyy-mm-dd"
        });

    })

    let componentTypeUrl = /*[[@{/componentType}]]*/ "/componentType";

    let searchUrl = /*[[@{/componentList}]]*/ "/componentList";

    let objStateUrl = /*[[@{/objState}]]*/ "/objState";


    $(function () {
        $.ajaxUtil.get(objStateUrl, function (e) {
            objState = e;
        })
        add();
    })
    var objStare;
</script>
</body>
</html>

